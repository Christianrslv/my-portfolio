---
import ThemeToggle from './ThemeToggle.astro';

interface Props {
	logo?: string;
	links?: Array<{ label: string; href: string }>;
}

const { logo = 'Portfolio', links = [
	{ label: 'Home', href: '#home' },
	{ label: 'About', href: '#about' },
	{ label: 'Skills', href: '#skills' },
	{ label: 'Projects', href: '#projects' },
	{ label: 'Contact', href: '#contact' },
] } = Astro.props;
---

<!-- Desktop navbar -->
<nav class="navbar fixed top-0 left-0 right-0 z-[2000] bg-[rgba(250,250,250,0.35)] dark:bg-[rgba(15,23,42,0.35)] backdrop-blur-[20px] border-b transition-all duration-200 hidden lg:block">
	<div class="w-full px-12 py-6 lg:px-8 xl:px-12 flex justify-between items-center">
		<a href="#home" class="nav-logo font-serif text-xl font-normal no-underline transition-colors duration-200 tracking-wide">{logo}</a>
		<div class="flex items-center gap-4">
			<ul class="flex list-none gap-8 m-0 p-0">
				{links.map((link) => (
					<li><a href={link.href} class="nav-link no-underline font-light text-[0.95rem] transition-colors duration-200 relative tracking-wide">{link.label}</a></li>
				))}
			</ul>
			<ThemeToggle />
		</div>
	</div>
</nav>

<!-- Mobile menu with Alpine.js - responsive horizontal expansion -->
<div 
	x-data="{ open: false }" 
	class="lg:hidden fixed bottom-6 right-4 left-4 z-[2000] flex justify-end pointer-events-none"
	id="mobile-menu-container"
>
	<!-- Container that expands horizontally - fully transparent -->
	<div 
		class="mobile-menu-bar pointer-events-auto flex items-center justify-end min-h-16 rounded-full transition-all duration-300 ease-out overflow-hidden"
		:class="open ? 'w-full sm:w-auto rounded-3xl sm:rounded-full px-4 sm:pl-5 sm:pr-1 py-3 sm:py-0' : 'w-16'"
	>
		<!-- Menu items - shown when open -->
		<div 
			x-show="open"
			x-transition:enter="transition ease-out duration-300"
			x-transition:enter-start="opacity-0 -translate-x-4"
			x-transition:enter-end="opacity-100 translate-x-0"
			x-transition:leave="transition ease-in duration-200"
			x-transition:leave-start="opacity-100 translate-x-0"
			x-transition:leave-end="opacity-0 -translate-x-4"
			class="flex flex-wrap sm:flex-nowrap items-center justify-center sm:justify-start gap-3 sm:gap-5 pr-2 sm:pr-3 flex-1 sm:flex-initial"
		>
			{links.map((link) => (
				<a 
					href={link.href} 
					@click="open = false"
					class="mobile-nav-link whitespace-nowrap no-underline font-semibold text-sm transition-colors duration-300"
				>
					{link.label}
				</a>
			))}
			<!-- Theme toggle - always visible, icon-only on small screens -->
			<div class="mobile-theme-toggle sm:border-l sm:border-current/20 sm:pl-4 sm:ml-1">
				<ThemeToggle />
			</div>
		</div>

		<!-- Toggle button -->
		<button 
			type="button" 
			@click="open = !open"
			@click.outside="open = false"
			:aria-expanded="open"
			class="mobile-menu-button w-16 h-16 flex-shrink-0 rounded-full cursor-pointer flex items-center justify-center transition-all duration-200" 
			aria-label="Toggle menu"
		>
			<!-- Hamburger icon -->
			<svg 
				x-show="!open" 
				x-transition:enter="transition ease-out duration-200"
				x-transition:enter-start="opacity-0 rotate-90"
				x-transition:enter-end="opacity-100 rotate-0"
				x-transition:leave="transition ease-in duration-150"
				x-transition:leave-start="opacity-100 rotate-0"
				x-transition:leave-end="opacity-0 rotate-90"
				class="w-7 h-7 absolute" 
				viewBox="0 0 24 24" 
				fill="none" 
				stroke="currentColor" 
				stroke-width="2.5"
			>
				<line x1="3" y1="6" x2="21" y2="6"></line>
				<line x1="3" y1="12" x2="21" y2="12"></line>
				<line x1="3" y1="18" x2="21" y2="18"></line>
			</svg>
			<!-- Close icon -->
			<svg 
				x-show="open" 
				x-transition:enter="transition ease-out duration-200"
				x-transition:enter-start="opacity-0 rotate-90"
				x-transition:enter-end="opacity-100 rotate-0"
				x-transition:leave="transition ease-in duration-150"
				x-transition:leave-start="opacity-100 rotate-0"
				x-transition:leave-end="opacity-0 rotate-90"
				class="w-7 h-7 absolute" 
				viewBox="0 0 24 24" 
				fill="none" 
				stroke="currentColor" 
				stroke-width="2.5"
			>
				<line x1="18" y1="6" x2="6" y2="18"></line>
				<line x1="6" y1="6" x2="18" y2="18"></line>
			</svg>
		</button>
	</div>
</div>

<style>
	.navbar {
		border-color: var(--border-color);
	}

	.nav-logo {
		color: var(--text-primary);
	}

	.nav-logo:hover {
		color: var(--accent-primary);
	}

	.nav-link {
		color: var(--text-secondary);
	}

	/* Nav link underline animation */
	.nav-link::after {
		content: '';
		position: absolute;
		bottom: -4px;
		left: 0;
		width: 0;
		height: 1px;
		background: var(--accent-primary);
		transition: width 0.2s ease;
	}

	.nav-link:hover {
		color: var(--accent-primary);
	}

	.nav-link:hover::after {
		width: 100%;
	}

	/* =============================================
	   FROSTED GLASS MOBILE MENU BAR
	   Premium glassmorphism with depth & reflections
	   ============================================= */
	
	.mobile-menu-bar {
		position: relative;
		
		/* Subtle frosted glass background */
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.12) 0%,
			rgba(255, 255, 255, 0.06) 50%,
			rgba(255, 255, 255, 0.03) 100%
		);
		
		/* Subtle blur for frosted effect */
		backdrop-filter: blur(4px);
		-webkit-backdrop-filter: blur(4px);
		
		/* Glass border */
		border: 1px solid rgba(255, 255, 255, 0.2);
		
		/* Layered shadows for depth & glass feel */
		box-shadow:
			/* Top edge highlight - light hitting top of glass */
			inset 0 1px 1px 0 rgba(255, 255, 255, 0.4),
			/* Left edge highlight - side reflection */
			inset 1px 0 1px 0 rgba(255, 255, 255, 0.2),
			/* Bottom inner shadow - depth */
			inset 0 -1px 2px 0 rgba(0, 0, 0, 0.05),
			/* Outer glow - soft light around glass */
			0 2px 8px rgba(0, 0, 0, 0.08),
			/* Depth shadow - floating effect */
			0 8px 24px rgba(0, 0, 0, 0.12);
		
		/* GPU acceleration */
		transform: translateZ(0);
		will-change: transform;
	}

	/* Gradient border overlay using pseudo-element */
	.mobile-menu-bar::before {
		content: '';
		position: absolute;
		inset: -1px;
		border-radius: inherit;
		padding: 1px;
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.5) 0%,
			rgba(255, 255, 255, 0.15) 20%,
			rgba(255, 255, 255, 0.05) 40%,
			rgba(255, 255, 255, 0) 50%,
			rgba(255, 255, 255, 0.05) 60%,
			rgba(255, 255, 255, 0.1) 80%,
			rgba(255, 255, 255, 0.3) 100%
		);
		-webkit-mask: 
			linear-gradient(#fff 0 0) content-box, 
			linear-gradient(#fff 0 0);
		-webkit-mask-composite: xor;
		mask-composite: exclude;
		pointer-events: none;
		opacity: 0.7;
		transition: opacity 0.3s ease;
	}

	/* Subtle shimmer on hover */
	.mobile-menu-bar:hover::before {
		opacity: 1;
	}

	/* Dark mode adjustments - more prominent glass effect */
	html.dark .mobile-menu-bar {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.08) 0%,
			rgba(255, 255, 255, 0.04) 50%,
			rgba(255, 255, 255, 0.02) 100%
		);
		border: 1px solid rgba(255, 255, 255, 0.15);
		box-shadow:
			inset 0 1px 1px 0 rgba(255, 255, 255, 0.25),
			inset 1px 0 1px 0 rgba(255, 255, 255, 0.15),
			inset 0 -1px 2px 0 rgba(0, 0, 0, 0.2),
			0 2px 8px rgba(0, 0, 0, 0.2),
			0 8px 24px rgba(0, 0, 0, 0.3);
	}

	html.dark .mobile-menu-bar::before {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.35) 0%,
			rgba(255, 255, 255, 0.1) 20%,
			rgba(255, 255, 255, 0.03) 40%,
			rgba(255, 255, 255, 0) 50%,
			rgba(255, 255, 255, 0.03) 60%,
			rgba(255, 255, 255, 0.08) 80%,
			rgba(255, 255, 255, 0.2) 100%
		);
		opacity: 0.6;
	}

	html.dark .mobile-menu-bar:hover::before {
		opacity: 0.9;
	}

	/* Light background detected - darker glass tint */
	.mobile-menu-bar.light-bg {
		background: linear-gradient(
			135deg,
			rgba(0, 0, 0, 0.04) 0%,
			rgba(0, 0, 0, 0.02) 50%,
			rgba(0, 0, 0, 0.01) 100%
		);
		border: 1px solid rgba(0, 0, 0, 0.08);
		box-shadow:
			inset 0 1px 1px 0 rgba(255, 255, 255, 0.6),
			inset 1px 0 1px 0 rgba(255, 255, 255, 0.3),
			inset 0 -1px 2px 0 rgba(0, 0, 0, 0.03),
			0 2px 8px rgba(0, 0, 0, 0.05),
			0 8px 24px rgba(0, 0, 0, 0.08);
	}

	.mobile-menu-bar.light-bg::before {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.8) 0%,
			rgba(255, 255, 255, 0.3) 20%,
			rgba(255, 255, 255, 0.1) 40%,
			rgba(255, 255, 255, 0) 50%,
			rgba(0, 0, 0, 0.02) 60%,
			rgba(0, 0, 0, 0.04) 80%,
			rgba(0, 0, 0, 0.06) 100%
		);
	}

	/* Dark background detected - lighter glass edges */
	.mobile-menu-bar.dark-bg {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.1) 0%,
			rgba(255, 255, 255, 0.05) 50%,
			rgba(255, 255, 255, 0.02) 100%
		);
		border: 1px solid rgba(255, 255, 255, 0.18);
		box-shadow:
			inset 0 1px 1px 0 rgba(255, 255, 255, 0.3),
			inset 1px 0 1px 0 rgba(255, 255, 255, 0.2),
			inset 0 -1px 2px 0 rgba(0, 0, 0, 0.15),
			0 2px 8px rgba(0, 0, 0, 0.15),
			0 8px 24px rgba(0, 0, 0, 0.25);
	}

	.mobile-menu-bar.dark-bg::before {
		background: linear-gradient(
			135deg,
			rgba(255, 255, 255, 0.4) 0%,
			rgba(255, 255, 255, 0.12) 20%,
			rgba(255, 255, 255, 0.04) 40%,
			rgba(255, 255, 255, 0) 50%,
			rgba(255, 255, 255, 0.04) 60%,
			rgba(255, 255, 255, 0.1) 80%,
			rgba(255, 255, 255, 0.25) 100%
		);
	}

	/* =============================================
	   TEXT COLORS - Contrast aware
	   ============================================= */

	/* Default: dark text for light backgrounds */
	.mobile-menu-bar .mobile-nav-link,
	.mobile-menu-bar .mobile-menu-button,
	.mobile-menu-bar svg {
		color: #1f2937;
		text-shadow: 0 1px 2px rgba(255, 255, 255, 0.5);
	}

	.mobile-menu-bar .mobile-nav-link:hover {
		color: #000;
	}

	/* Dark mode: light text */
	html.dark .mobile-menu-bar .mobile-nav-link,
	html.dark .mobile-menu-bar .mobile-menu-button,
	html.dark .mobile-menu-bar svg {
		color: #f9fafb;
		text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
	}

	html.dark .mobile-menu-bar .mobile-nav-link:hover {
		color: #fff;
	}

	/* Light background detected */
	.mobile-menu-bar.light-bg .mobile-nav-link,
	.mobile-menu-bar.light-bg .mobile-menu-button,
	.mobile-menu-bar.light-bg svg {
		color: #1f2937;
		text-shadow: 0 1px 2px rgba(255, 255, 255, 0.6);
	}

	/* Dark background detected */
	.mobile-menu-bar.dark-bg .mobile-nav-link,
	.mobile-menu-bar.dark-bg .mobile-menu-button,
	.mobile-menu-bar.dark-bg svg {
		color: #f9fafb;
		text-shadow: 0 1px 3px rgba(0, 0, 0, 0.6);
	}

	/* Mobile nav link base styles */
	.mobile-nav-link {
		font-weight: 600;
		transition: color 0.3s ease;
	}

	/* Hide theme toggle label on small screens (icon only) */
	@media (max-width: 639px) {
		.mobile-theme-toggle .theme-label {
			display: none;
		}
		
		.mobile-theme-toggle .theme-toggle {
			padding-left: 0.5rem;
			padding-right: 0.5rem;
		}
	}
</style>

<script is:inline>
	// Contrast detection for mobile menu
	(function initContrastDetection() {
		const menuBar = document.querySelector('.mobile-menu-bar');
		if (!menuBar) return;

		function detectBackgroundContrast() {
			// Get the center point of the menu
			const rect = menuBar.getBoundingClientRect();
			const x = rect.left + rect.width / 2;
			const y = rect.top + rect.height / 2;

			// Hide the menu temporarily to sample the background
			const originalVisibility = menuBar.style.visibility;
			menuBar.style.visibility = 'hidden';

			// Get element at that point
			const elementBehind = document.elementFromPoint(x, y);
			menuBar.style.visibility = originalVisibility;

			if (!elementBehind) return;

			// Get computed background color
			let bgColor = null;
			let currentEl = elementBehind;
			
			while (currentEl && currentEl !== document.body) {
				const style = window.getComputedStyle(currentEl);
				const bg = style.backgroundColor;
				
				if (bg && bg !== 'rgba(0, 0, 0, 0)' && bg !== 'transparent') {
					bgColor = bg;
					break;
				}
				currentEl = currentEl.parentElement;
			}

			// Fallback to body background
			if (!bgColor) {
				bgColor = window.getComputedStyle(document.body).backgroundColor;
			}

			// Parse RGB values
			const rgb = bgColor.match(/\d+/g);
			if (!rgb || rgb.length < 3) return;

			// Calculate relative luminance
			const luminance = (0.299 * parseInt(rgb[0]) + 0.587 * parseInt(rgb[1]) + 0.114 * parseInt(rgb[2])) / 255;

			// Apply appropriate class
			menuBar.classList.remove('light-bg', 'dark-bg');
			if (luminance > 0.5) {
				menuBar.classList.add('light-bg');
			} else {
				menuBar.classList.add('dark-bg');
			}
		}

		// Run on scroll and resize with throttling
		let ticking = false;
		function requestTick() {
			if (!ticking) {
				requestAnimationFrame(() => {
					detectBackgroundContrast();
					ticking = false;
				});
				ticking = true;
			}
		}

		window.addEventListener('scroll', requestTick, { passive: true });
		window.addEventListener('resize', requestTick, { passive: true });
		
		// Initial detection
		setTimeout(detectBackgroundContrast, 100);
		
		// Also detect on theme change
		const observer = new MutationObserver((mutations) => {
			mutations.forEach((mutation) => {
				if (mutation.attributeName === 'class') {
					setTimeout(detectBackgroundContrast, 50);
				}
			});
		});
		
		observer.observe(document.documentElement, { attributes: true });
	})();
</script>
