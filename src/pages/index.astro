---
import Layout from '../layouts/Layout.astro';
import Navbar from '../components/Navbar.astro';
import Hero from '../components/Hero.astro';
import About from '../components/About.astro';
import Skills from '../components/Skills.astro';
import Projects from '../components/Projects.astro';
import HorizontalTimeline from '../components/HorizontalTimeline.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
import ScrollIndicator from '../components/ScrollIndicator.astro';
import MobileTimeline from '../components/MobileTimeline.astro';
import { portfolioConfig } from '../data/config';
import { getPortfolioContent } from '../utils/content';
import { getPortfolioContentSimple } from '../utils/content-simple';
import { getCollection } from 'astro:content';

// Try multiple methods to load content
let content = null;

// Method 1: Try Content Collections
try {
	console.log('[Index] Attempting Content Collections...');
	const portfolioEntries = await getCollection('portfolio');
	console.log('[Index] Content Collections - entries:', portfolioEntries.length);
	
	if (portfolioEntries.length > 0) {
		content = await getPortfolioContent();
		console.log('[Index] Content Collections loaded:', !!content);
	}
} catch (error) {
	console.warn('[Index] Content Collections failed:', error);
}

// Method 2: Fallback to simple glob loader
if (!content) {
	try {
		console.log('[Index] Trying simple glob loader...');
		content = await getPortfolioContentSimple();
		console.log('[Index] Simple loader result:', !!content);
	} catch (error) {
		console.warn('[Index] Simple loader failed:', error);
	}
}

// Debug logging
console.log('[Index] Content loaded:', !!content);
if (content) {
	console.log('[Index] Using Markdown content');
	console.log('[Index] Hero from content:', content.hero);
} else {
	console.log('[Index] Using config.ts fallback');
}

// Merge content with config fallback
const config = {
	nav: portfolioConfig.nav,
	hero: content?.hero || portfolioConfig.hero,
	about: {
		...portfolioConfig.about,
		...(content?.about || {}),
	},
	skills: content?.skills || portfolioConfig.skills,
	projects: content?.projects || portfolioConfig.projects,
	contact: content?.contact || portfolioConfig.contact,
	footer: portfolioConfig.footer,
};

console.log('[Index] Final hero name:', config.hero.name);
console.log('[Index] Final config.hero:', config.hero);
console.log('[Index] About imageUrl:', config.about.imageUrl);
console.log('[Index] About showImage:', config.about.showImage);
---

<Layout>
	<Navbar logo={config.nav?.logo || portfolioConfig.nav.logo} links={config.nav?.links || portfolioConfig.nav.links} />

	<ScrollIndicator totalSections={6} />

	<div id="scroll-root" class="relative">
		<!-- Test animated ball for scroll progress -->
		<div id="scroll-progress-ball" class="scroll-progress-ball hidden lg:block"></div>
		<div 
			id="scroll-stage-bg"
			class="scroll-stage relative h-screen w-full overflow-hidden"
			data-background-image={config.hero.backgroundImage || ''}
		>
			<div class="base-background"></div>
			{config.hero.backgroundImage && (
				<>
					<div 
						class="background-image-layer"
						style={`background-image: url('${config.hero.backgroundImage}');`}
					></div>
					<!-- Full overlay for Section 0 -->
					<div class="overlay-full"></div>
					<!-- Gradient overlay for Section 1 (left side dark, right side transparent) -->
					<div class="overlay-gradient"></div>
				</>
			)}
			<section id="home" class="scroll-panel flex min-h-screen w-full items-center justify-center">
				<Hero
					greeting={config.hero.greeting}
					name={config.hero.name}
					role={config.hero.role}
					description={config.hero.description}
					primaryButton={config.hero.primaryButton}
					secondaryButton={config.hero.secondaryButton}
				/>
			</section>

			<section id="about" class="scroll-panel flex min-h-screen w-full items-center justify-center">
				<About
					paragraphs={config.about.paragraphs}
					stats={portfolioConfig.about.stats}
				/>
			</section>

			<section id="skills" class="scroll-panel flex min-h-screen w-full items-center justify-center h-[calc(100dvh+300px)] lg:h-screen">
				<Skills categories={config.skills.categories} />
			</section>

			<section id="projects" class="scroll-panel flex min-h-screen h-[calc(100dvh+300px)] lg:h-screen w-full items-center justify-center">
				<Projects projects={config.projects} />
			</section>

      <HorizontalTimeline class="hidden lg:flex"/>
      <MobileTimeline class="lg:hidden"/>
      
			<section id="contact" class="scroll-panel flex flex-col min-h-screen w-full items-center justify-center z-90!">
				<Contact
					description={config.contact.description}
					email={config.contact.email}
					socialLinks={config.contact.socialLinks}
				/>
				<Footer text={portfolioConfig.footer.text} year={portfolioConfig.footer.year} />
			</section>
		</div>
	</div>
</Layout>

<script>
	// @ts-nocheck
	import gsap from 'gsap';
	import ScrollTrigger from 'gsap/ScrollTrigger';

	gsap.registerPlugin(ScrollTrigger);

	// ============================================
	// CONSTANTS & CONFIGURATION
	// ============================================
	const BREAKPOINT_MOBILE = 1024;
	const SECTION_SCROLL_UNITS = 0.80;
	const TIMELINE_SCROLL_UNITS = 0.75;
	const SECTION_TOLERANCE = 1.5;
	const BACKGROUND_IMAGE_END_SECTION = 2;
	const ZOOM_START = 1.0;
	const ZOOM_END = 1.5;
	const ZOOM_COMPLETION_POINT = 0.7;
	const EXIT_COMPLETION_POINT = 0.6;
	const EXIT_TRANSLATE_DISTANCE = -40;
	const RESIZE_DEBOUNCE_MS = 150;

	// ============================================
	// UTILITY FUNCTIONS
	// ============================================
	const isMobile = () => window.innerWidth <= BREAKPOINT_MOBILE;

	const getDatasetValue = (element, key, defaultValue) => {
		return parseInt(element.dataset[key] || defaultValue, 10);
	};

	const clamp = (value, min, max) => Math.max(min, Math.min(max, value));

	const setElementVisibility = (element, opacity) => {
		if (!element) return;
		element.style.opacity = String(Math.max(0, opacity));
		element.style.visibility = opacity > 0.01 ? 'visible' : 'hidden';
	};

	// ============================================
	// TIMELINE CALCULATIONS
	// ============================================
	function calculateTimelineData(sections) {
		const timelineSection = sections.find(s => s.id === 'desktop-timeline');
		const timelineEntries = timelineSection
			? parseInt(timelineSection.dataset.timelineEntries || '1', 10)
			: 1;
		const timelineSegments = Math.max(0, timelineEntries - 1);
		const timelineUnits = timelineSegments > 0
			? timelineSegments * TIMELINE_SCROLL_UNITS
			: SECTION_SCROLL_UNITS;
		const timelineIndex = sections.findIndex(s => s.id === 'desktop-timeline');
		const extraUnits = timelineIndex >= 0 ? Math.max(0, timelineUnits - SECTION_SCROLL_UNITS) : 0;

		return { timelineSegments, timelineUnits, timelineIndex, extraUnits };
	}

	function calculateScrollHeight(sections, scrollRoot) {
		const total = sections.length;
		const { timelineSegments, timelineUnits, extraUnits } = calculateTimelineData(sections);
		const totalSegments = (total - 1) * SECTION_SCROLL_UNITS + extraUnits;
		const scrollDistance = (totalSegments + 1) * window.innerHeight;

		// Store in dataset for later retrieval
		scrollRoot.dataset.totalSegments = String(totalSegments);
		scrollRoot.dataset.timelineSegments = String(timelineSegments);
		scrollRoot.dataset.timelineUnits = String(timelineUnits);
		scrollRoot.dataset.timelineExtraUnits = String(extraUnits);
		scrollRoot.style.height = `${scrollDistance}px`;

		console.log('[GSAP] Scroll height calculated', {
			scrollDistance,
			totalSegments,
			timelineSegments,
			timelineUnits,
			extraUnits
		});

		return scrollDistance;
	}

	// ============================================
	// SECTION MANAGEMENT
	// ============================================
	function initializeSectionPositions(sections) {
		sections.forEach((section, index) => {
			const xOffset = index % 2 === 0 ? -60 : 60;
			gsap.set(section, {
				autoAlpha: 0,
				y: 40,
				x: xOffset,
				position: 'absolute',
				top: 0,
				left: 0,
				width: '100%',
			});
		});
		gsap.set(sections[0], { autoAlpha: 1, y: 0, x: 0 });
	}

	function calculateTargetSection(exactProgress, total) {
		const rawFrac = exactProgress - Math.floor(exactProgress);
		let targetIndex = Math.floor(exactProgress);

		if (rawFrac < SECTION_TOLERANCE) {
			targetIndex = Math.floor(exactProgress);
		} else if (rawFrac > 1 - SECTION_TOLERANCE) {
			targetIndex = Math.min(total - 1, Math.floor(exactProgress) + 1);
		} else {
			targetIndex = rawFrac < 0.5
				? Math.floor(exactProgress)
				: Math.min(total - 1, Math.floor(exactProgress) + 1);
		}

		return clamp(targetIndex, 0, total - 1);
	}

	function animateSection(section, index, isActive) {
		const xOffset = index % 2 === 0 ? -60 : 60;

		gsap.to(section, {
			autoAlpha: isActive ? 1 : 0,
			y: isActive ? 0 : 40,
			x: isActive ? 0 : xOffset,
			duration: 0.3,
			ease: 'power2.out',
			overwrite: true,
		});
	}

	function updateSectionVisibility(sections, targetIndex, activeIndex) {
		if (targetIndex === activeIndex) return activeIndex;

		sections.forEach((section, i) => {
			animateSection(section, i, i === targetIndex);
		});

		window.dispatchEvent(new CustomEvent('sectionchange', {
			detail: { index: targetIndex }
		}));

		return targetIndex;
	}

	// ============================================
	// PROGRESS CALCULATIONS
	// ============================================
	function calculateProgress(exactProgress, sections, scrollRoot) {
		const timelineIndex = sections.findIndex(s => s.id === 'desktop-timeline');
		const timelineUnits = getDatasetValue(
			scrollRoot,
			'timelineUnits',
			String(TIMELINE_SCROLL_UNITS)
		);
		const timelineLength = timelineIndex >= 0 ? timelineUnits : SECTION_SCROLL_UNITS;
		const timelineExtraUnits = getDatasetValue(scrollRoot, 'timelineExtraUnits', '0');

		let mappedProgress = exactProgress / SECTION_SCROLL_UNITS;
		let timelineProgress = 0;

		if (timelineIndex >= 0) {
			const timelineStart = timelineIndex * SECTION_SCROLL_UNITS;
			const timelineEnd = timelineStart + timelineLength;

			if (exactProgress < timelineStart) {
				mappedProgress = exactProgress / SECTION_SCROLL_UNITS;
				timelineProgress = 0;
			} else if (exactProgress >= timelineStart && exactProgress <= timelineEnd) {
				timelineProgress = (exactProgress - timelineStart) / timelineLength;
				const transitionStart = timelineEnd - SECTION_SCROLL_UNITS;

				if (exactProgress < transitionStart) {
					mappedProgress = timelineIndex;
				} else {
					const transitionProgress = (exactProgress - transitionStart) / SECTION_SCROLL_UNITS;
					mappedProgress = timelineIndex + transitionProgress;
				}
			} else {
				mappedProgress = (exactProgress - timelineExtraUnits) / SECTION_SCROLL_UNITS;
				timelineProgress = 1;
			}
		}

		return { mappedProgress, timelineProgress };
	}

	// ============================================
	// BACKGROUND ANIMATION
	// ============================================
	function calculateZoomProgress(currentSection, sectionProgress, isDesktop) {
		if (currentSection !== 0) return { zoomProgress: 1, zoomScale: isDesktop ? ZOOM_END : 1.0 };

		const zoomProgress = Math.min(1, sectionProgress / ZOOM_COMPLETION_POINT);
		const zoomScale = isDesktop
			? ZOOM_START + (ZOOM_END - ZOOM_START) * zoomProgress
			: 1.0;

		return { zoomProgress, zoomScale };
	}

	function calculateExitProgress(currentSection, sectionProgress) {
		if (currentSection === 1) {
			return Math.min(1, sectionProgress / EXIT_COMPLETION_POINT);
		}
		return currentSection >= 2 ? 1 : 0;
	}

	function updateBackgroundImage(backgroundImageLayer, currentSection, sectionProgress, isDesktop) {
		backgroundImageLayer.style.backgroundPosition = 'right bottom';

		const { zoomProgress, zoomScale } = calculateZoomProgress(currentSection, sectionProgress, isDesktop);
		const exitProgress = calculateExitProgress(currentSection, sectionProgress);
		const exitTranslate = exitProgress * EXIT_TRANSLATE_DISTANCE;

		backgroundImageLayer.style.transform = `translateX(${exitTranslate}vw) scale(${zoomScale})`;

		return { zoomProgress, exitProgress };
	}

	function updateOverlays(overlayFull, overlayGradient, currentSection, zoomProgress, exitProgress) {
		const overlayTransitionProgress = currentSection === 0 ? zoomProgress : 1;

		if (currentSection >= BACKGROUND_IMAGE_END_SECTION) {
			// Section 2+: Hide everything
			setElementVisibility(overlayFull, 0);
			setElementVisibility(overlayGradient, 0);
		} else if (currentSection === 1) {
			// Section 1: Gradient visible, fades with exit
			setElementVisibility(overlayFull, 0);
			setElementVisibility(overlayGradient, 1 - exitProgress);
		} else {
			// Section 0: Transition from full to gradient
			setElementVisibility(overlayFull, 1 - overlayTransitionProgress);
			setElementVisibility(overlayGradient, overlayTransitionProgress);
		}
	}

	function updateBackgroundLayers(clampedMappedProgress) {
		const backgroundStage = document.getElementById('scroll-stage-bg');
		if (!backgroundStage?.dataset.backgroundImage) return;

		const backgroundImageLayer = backgroundStage.querySelector('.background-image-layer');
		const overlayFull = backgroundStage.querySelector('.overlay-full');
		const overlayGradient = backgroundStage.querySelector('.overlay-gradient');

		if (!backgroundImageLayer) return;

		const currentSection = Math.floor(clampedMappedProgress);
		const sectionProgress = clampedMappedProgress - currentSection;
		const isDesktop = window.innerWidth >= BREAKPOINT_MOBILE;

		const { zoomProgress, exitProgress } = updateBackgroundImage(
			backgroundImageLayer,
			currentSection,
			sectionProgress,
			isDesktop
		);

		// Handle image visibility
		if (currentSection >= BACKGROUND_IMAGE_END_SECTION) {
			setElementVisibility(backgroundImageLayer, 0);
		} else if (currentSection === 1) {
			setElementVisibility(backgroundImageLayer, 1 - exitProgress);
		} else {
			backgroundImageLayer.style.opacity = '1';
			backgroundImageLayer.style.visibility = 'visible';
		}

		updateOverlays(overlayFull, overlayGradient, currentSection, zoomProgress, exitProgress);
	}

	// ============================================
	// PROGRESS BALL ANIMATION
	// ============================================
	function updateProgressBall(scrollProgress) {
		const progressBall = document.getElementById('scroll-progress-ball');
		if (!progressBall) return;

		const maxX = window.innerWidth - 60;
		const xPosition = scrollProgress * maxX;
		const yPosition = 50 + Math.sin(scrollProgress * Math.PI * 4) * 30;

		gsap.to(progressBall, {
			x: xPosition,
			y: yPosition,
			duration: 0.1,
			ease: 'none',
			overwrite: true,
		});
	}

	// ============================================
	// NAVIGATION
	// ============================================
	function scrollToSection(sections, scrollRoot, scrollDistance, targetIndex) {
		const total = sections.length;
		const totalSegments = getDatasetValue(
			scrollRoot,
			'totalSegments',
			String((total - 1) * SECTION_SCROLL_UNITS)
		);
		const timelineUnits = getDatasetValue(
			scrollRoot,
			'timelineUnits',
			String(TIMELINE_SCROLL_UNITS)
		);
		const timelineIndex = sections.findIndex(s => s.id === 'desktop-timeline');
		const extraUnits = Math.max(0, timelineUnits - SECTION_SCROLL_UNITS);
		const step = (scrollDistance - window.innerHeight) / totalSegments;
		const segment = timelineIndex >= 0 && targetIndex > timelineIndex
			? targetIndex * SECTION_SCROLL_UNITS + extraUnits
			: targetIndex * SECTION_SCROLL_UNITS;

		window.scrollTo({
			top: step * segment,
			behavior: 'smooth',
		});
	}

	function setupNavigation(sections, scrollRoot, scrollDistance) {
		// Anchor link navigation
		document.addEventListener('click', (e) => {
			const anchor = e.target?.closest?.('a[href^="#"]');
			if (!anchor) return;

			e.preventDefault();
			const href = anchor.getAttribute('href') || '';
			const targetId = href.replace('#', '');
			const targetIndex = sections.findIndex(s => s.id === targetId);

			if (targetIndex !== -1) {
				scrollToSection(sections, scrollRoot, scrollDistance, targetIndex);
			}
		});

		// Custom event navigation
		window.addEventListener('gotosection', (e) => {
			const index = e.detail?.index;
			if (typeof index === 'number') {
				scrollToSection(sections, scrollRoot, scrollDistance, index);
			}
		});
	}

	// ============================================
	// SCROLL TRIGGER SETUP
	// ============================================
	function createScrollTrigger(sections, scrollRoot, scrollStage, scrollDistance) {
		const total = sections.length;
		let activeIndex = 0;

		const progressBall = document.getElementById('scroll-progress-ball');
		if (progressBall) {
			gsap.set(progressBall, { x: 0, y: 50 });
		}

		ScrollTrigger.create({
			trigger: scrollRoot,
			start: 'top top',
			end: () => `+=${scrollDistance - window.innerHeight}`,
			scrub: 2,
			pin: scrollStage,
			anticipatePin: 1,
			snap: false,
			onUpdate: (self) => {
				const totalSegments = getDatasetValue(
					scrollRoot,
					'totalSegments',
					String((total - 1) * SECTION_SCROLL_UNITS)
				);

				const exactProgress = self.progress * totalSegments;
				const { mappedProgress, timelineProgress } = calculateProgress(
					exactProgress,
					sections,
					scrollRoot
				);

				const clampedMappedProgress = clamp(mappedProgress, 0, total - 1);
				const clampedTimelineProgress = clamp(timelineProgress, 0, 1);

				// Update background layers
				updateBackgroundLayers(clampedMappedProgress);

				// Update section visibility
				const targetIndex = calculateTargetSection(clampedMappedProgress, total);
				activeIndex = updateSectionVisibility(sections, targetIndex, activeIndex);

				// Update progress ball
				updateProgressBall(self.progress);

				// Dispatch timeline progress event
				const timelineIndex = sections.findIndex(s => s.id === 'desktop-timeline');
				if (timelineIndex >= 0) {
					window.dispatchEvent(new CustomEvent('timelineprogress', {
						detail: { progress: clampedTimelineProgress }
					}));
				}
			},
		});
	}

	// ============================================
	// DESKTOP SCROLL EXPERIENCE
	// ============================================
	function initDesktopScrollExperience(scrollRoot, scrollStage, sections) {
		console.log('[GSAP] Desktop detected - initializing GSAP scroll experience');

		const scrollDistance = calculateScrollHeight(sections, scrollRoot);
		initializeSectionPositions(sections);
		createScrollTrigger(sections, scrollRoot, scrollStage, scrollDistance);
		setupNavigation(sections, scrollRoot, scrollDistance);

		// Handle window resize
		window.addEventListener('resize', () => {
			calculateScrollHeight(sections, scrollRoot);
			ScrollTrigger.refresh();
		});
	}

	// ============================================
	// MOBILE SCROLL EXPERIENCE
	// ============================================
	function resetMobileStyles(sections, scrollRoot) {
		console.log('[GSAP] Mobile detected - using CSS card stacking');

		sections.forEach(section => {
			gsap.set(section, { clearProps: 'all' });
		});

		scrollRoot.style.height = 'auto';
	}

	function initMobileBackgroundFade() {
		if (!isMobile()) return;

		const backgroundImageLayer = document.querySelector('.background-image-layer');
		const overlayFull = document.querySelector('.overlay-full');
		const overlayGradient = document.querySelector('.overlay-gradient');
		const baseBackground = document.querySelector('.base-background');
		const heroSection = document.getElementById('home');
		const aboutSection = document.getElementById('about');
		const skillsSection = document.getElementById('skills');

		if (!heroSection || !aboutSection) return;

		function updateBackgroundOnScroll() {
			if (!isMobile()) return;

			const scrollY = window.scrollY;
			const heroHeight = heroSection.offsetHeight;
			const aboutTop = aboutSection.offsetTop;
			const aboutHeight = aboutSection.offsetHeight;
			const skillsTop = skillsSection?.offsetTop || (aboutTop + aboutHeight);

			// Phase 1: Overlay transition during Hero
			const overlayTransitionEnd = heroHeight * ZOOM_COMPLETION_POINT;
			const overlayProgress = clamp(scrollY / overlayTransitionEnd, 0, 1);

			// Phase 2: Background fade when entering Skills
			const fadeStart = aboutTop + (aboutHeight * 0.5);
			const fadeEnd = skillsTop + (window.innerHeight * 0.3);
			const fadeProgress = scrollY > fadeStart
				? Math.min(1, (scrollY - fadeStart) / (fadeEnd - fadeStart))
				: 0;

			// Apply overlay transitions
			setElementVisibility(overlayFull, (1 - overlayProgress) * (1 - fadeProgress));
			setElementVisibility(overlayGradient, overlayProgress * (1 - fadeProgress));
			setElementVisibility(backgroundImageLayer, 1 - fadeProgress);

			if (baseBackground) {
				baseBackground.style.opacity = '1';
			}
		}

		window.addEventListener('scroll', updateBackgroundOnScroll, { passive: true });
		updateBackgroundOnScroll();
	}

	// ============================================
	// TIMELINE VISIBILITY
	// ============================================
	function handleTimelineVisibility() {
		const desktop = document.querySelector('#desktop-timeline');
		const mobile = document.querySelector('#mobile-timeline');

		if (!desktop || !mobile) {
			console.warn('[Timeline] Could not find timeline elements');
			return;
		}

		const mobileMode = isMobile();

		if (mobileMode) {
			desktop.style.setProperty('display', 'none', 'important');
			mobile.style.setProperty('display', 'flex', 'important');
			console.log('[Timeline] Showing mobile timeline');
		} else {
			mobile.style.setProperty('display', 'none', 'important');
			desktop.style.setProperty('display', 'flex', 'important');
			console.log('[Timeline] Showing desktop timeline');
		}
	}

	// ============================================
	// MAIN INITIALIZATION
	// ============================================
	function initScrollExperience() {
		const scrollRoot = document.querySelector('#scroll-root');
		const scrollStage = document.querySelector('.scroll-stage');
		const sections = Array.from(document.querySelectorAll('.scroll-panel'));

		if (!scrollRoot || !scrollStage || !sections.length) {
			return;
		}

		if (isMobile()) {
			resetMobileStyles(sections, scrollRoot);
			return;
		}

		initDesktopScrollExperience(scrollRoot, scrollStage, sections);
	}

	function init() {
		handleTimelineVisibility();
		initScrollExperience();
		initMobileBackgroundFade();
	}

	// ============================================
	// RESPONSIVE HANDLING
	// ============================================
	let currentMode = isMobile() ? 'mobile' : 'desktop';

	function handleResize() {
		const newMode = isMobile() ? 'mobile' : 'desktop';

		if (newMode !== currentMode) {
			console.log(`[GSAP] Mode changed: ${currentMode} -> ${newMode}`);
			currentMode = newMode;

			handleTimelineVisibility();
			ScrollTrigger.getAll().forEach(st => st.kill());
			initScrollExperience();
		}
	}

	// Debounced resize handler
	let resizeTimeout;
	window.addEventListener('resize', () => {
		clearTimeout(resizeTimeout);
		resizeTimeout = setTimeout(handleResize, RESIZE_DEBOUNCE_MS);
	});

	// Initialize on load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', init);
	} else {
		setTimeout(init, 50);
	}
</script>

<style>

@media (max-width: 1024px) {
    #mobile-timeline {
        position: relative !important; /* Remove sticky */
        min-height: auto !important;
    }
}
	#scroll-root {
		position: relative;
	}

	.scroll-stage {
		position: relative;
		width: 100%;
		height: 100vh;
		overflow: hidden;
	}

	/* Base background - shows when image moves/zooms or is hidden */
	.base-background {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background: linear-gradient(
			135deg,
			#a8cce3 0%,
			#b5d4e8 20%,
			#d4e9f2 40%,
			#c8e0ed 60%,
			#b5d4e8 80%,
			#a8cce3 100%
		);
		background-size: 300% 300%;
		animation: baseGradientShift 12s ease-in-out infinite;
		z-index: 0;
	}

	html.dark .base-background {
		background: linear-gradient(
			135deg,
			#070d17 0%,
			#0a1628 20%,
			#131d32 40%,
			#0f172a 60%,
			#0a1628 80%,
			#070d17 100%
		);
		background-size: 300% 300%;
		animation: baseGradientShift 12s ease-in-out infinite;
	}

	@keyframes baseGradientShift {
		0% {
			background-position: 0% 0%;
		}
		50% {
			background-position: 100% 100%;
		}
		100% {
			background-position: 0% 0%;
		}
	}

	/* Background image layer - on top of base background */
	.background-image-layer {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		width: 100%;
		height: 100%;
		background-size: cover;
		background-position: right bottom;
		background-repeat: no-repeat;
		transform-origin: right bottom;
		z-index: 1;
		pointer-events: none;
		transition: transform 0.15s linear;
	}

	/* ============================================
	   OVERLAY CUSTOMIZATION VARIABLES
	   Adjust these to fine-tune the overlay effect
	   
	   Breakpoints: xs(480) sm(640) md(768) lg(1024) xl(1280) 2xl(1536) 3xl(1920) 4xl(2560)
	   ============================================ */
	
	/* === BASE / MOBILE (default) === */
	:root {
		/* Overlay color: #b5d4e8 (primary color) */
		--overlay-color: 181, 212, 232;
		
		/* Full overlay (Section 0) */
		--full-direction: 135deg;
		--full-opacity-start: 0;
		--full-opacity-mid: 0;
		--full-opacity-end: 0;
		--full-stop-1: 0%;
		--full-stop-2: 50%;
		--full-stop-3: 100%;
		
		/* Gradient overlay (Section 1) */
		--grad-direction: 180deg;
		--grad-opacity-start: 1;
		--grad-opacity-mid: 0.8;
		--grad-opacity-end: 0;
		--grad-stop-1: 0%;
		--grad-stop-2: 35%;
		--grad-stop-3: 50%;
	}
	
	/* === xs: 480px === */
	@media (min-width: 480px) {
		:root {
			--grad-direction: 180deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 0%;
			--grad-stop-2: 35%;
			--grad-stop-3: 50%;
		}
	}
	
	/* === sm: 640px === */
	@media (min-width: 640px) {
		:root {
			--grad-direction: 180deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 0%;
			--grad-stop-2: 35%;
			--grad-stop-3: 50%;
		}
	}
	
	/* === md: 768px === */
	@media (min-width: 768px) {
		:root {
			--grad-direction: 180deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 0%;
			--grad-stop-2: 35%;
			--grad-stop-3: 50%;
		}
	}
	
	/* === lg: 1024px === */
	@media (min-width: 1024px) {
		:root {
			--grad-direction: 102deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 37%;
			--grad-stop-2: 44%;
			--grad-stop-3: 52%;
		}
	}
	
	/* === xl: 1280px === */
	@media (min-width: 1280px) {
		:root {
			--grad-direction: 100deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 38%;
			--grad-stop-2: 50%;
			--grad-stop-3: 62%;
		}
	}
	
	/* === 2xl: 1536px === */
	@media (min-width: 1536px) {
		:root {
			--grad-direction: 95deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 36%;
			--grad-stop-2: 50%;
			--grad-stop-3: 70%;
		}
	}
	
	/* === 3xl: 1920px === */
	@media (min-width: 1920px) {
		:root {
			--grad-direction: 95deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 40%;
			--grad-stop-2: 54%;
			--grad-stop-3: 76%;
		}
	}
	
	/* === 4xl: 2560px === */
	@media (min-width: 2560px) {
		:root {
			--grad-direction: 95deg;
			--grad-opacity-start: 1;
			--grad-opacity-mid: 0.8;
			--grad-opacity-end: 0;
			--grad-stop-1: 40%;
			--grad-stop-2: 54%;
			--grad-stop-3: 76%;
		}
	}
	
	/* === DARK MODE === */
	html.dark {
		--overlay-color: 15, 23, 42;
		
		--full-direction: 135deg;
		--full-opacity-start: 0.7;
		--full-opacity-mid: 0.5;
		--full-opacity-end: 0.4;
		--full-stop-1: 0%;
		--full-stop-2: 50%;
		--full-stop-3: 100%;
		
		--grad-direction: 180deg;
		--grad-opacity-start: 1;
		--grad-opacity-mid: 0.8;
		--grad-opacity-end: 0;
		--grad-stop-1: 0%;
		--grad-stop-1a: 17.5%;
		--grad-opacity-1a: 0.9;
		--grad-stop-2: 35%;
		--grad-stop-2a: 42.5%;
		--grad-opacity-2a: 0.4;
		--grad-stop-3: 50%;
	}
	
	/* Dark mode breakpoints */
	@media (min-width: 480px) {
		html.dark {
			--grad-direction: 180deg;
      --grad-opacity-start: 1;
      --grad-opacity-mid: 0.8;
      --grad-opacity-end: 0;
      --grad-stop-1: 0%;
      --grad-stop-1a: 17.5%;
      --grad-opacity-1a: 0.9;
      --grad-stop-2: 35%;
      --grad-stop-2a: 43.5%;
      --grad-opacity-2a: 0.6;
      --grad-stop-3: 60%;
		}
	}
	
	@media (min-width: 640px) {
		html.dark {
			--grad-direction: 180deg;
      --grad-opacity-start: 1;
      --grad-opacity-mid: 0.8;
      --grad-opacity-end: 0;
      --grad-stop-1: 0%;
      --grad-stop-1a: 17.5%;
      --grad-opacity-1a: 0.9;
      --grad-stop-2: 35%;
      --grad-stop-2a: 43.5%;
      --grad-opacity-2a: 0.6;
      --grad-stop-3: 60%;
		}
	}
	
	@media (min-width: 768px) {
		html.dark {
			--grad-direction: 180deg;
      --grad-opacity-start: 1;
      --grad-opacity-mid: 0.8;
      --grad-opacity-end: 0;
      --grad-stop-1: 0%;
      --grad-stop-1a: 17.5%;
      --grad-opacity-1a: 0.9;
      --grad-stop-2: 35%;
      --grad-stop-2a: 43.5%;
      --grad-opacity-2a: 0.6;
      --grad-stop-3: 60%;
		}
	}
	
	@media (min-width: 1024px) {
		html.dark {
			--grad-direction: 102deg;
      --grad-opacity-start: 0.8;
      --grad-opacity-mid: 0.6;
      --grad-opacity-end: 0;
      --grad-stop-1: 23%;
      --grad-stop-1a: 35%;
      --grad-opacity-1a: 0.715;
      --grad-stop-2: 47%;
      --grad-stop-2a: 65.5%;
      --grad-opacity-2a: 0.315;
      --grad-stop-3: 84%;
		}
	}
	
	@media (min-width: 1280px) {
		html.dark {
      --grad-direction: 100deg;
      --grad-opacity-start: 0.95;
      --grad-opacity-mid: 0.7;
      --grad-opacity-end: 0;
      --grad-stop-1: 14%;
      --grad-stop-1a: 27.5%;
      --grad-opacity-1a: 0.825;
      --grad-stop-2: 41%;
      --grad-stop-2a: 68%;
      --grad-opacity-2a: 0.35;
      --grad-stop-3: 95%;
		}
	}
	
	@media (min-width: 1536px) {
		html.dark {
      --grad-direction: 95deg;
      --grad-opacity-start: 0.96;
      --grad-opacity-mid: 0.7;
      --grad-opacity-end: 0;
      --grad-stop-1: 16%;
      --grad-stop-1a: 31%;
      --grad-opacity-1a: 0.83;
      --grad-stop-2: 46%;
      --grad-stop-2a: 70.5%;
      --grad-opacity-2a: 0.35;
      --grad-stop-3: 95%;
		}
	}
	
	@media (min-width: 1920px) {
		html.dark {
			--grad-direction: 95deg;
      --grad-opacity-start: 0.98;
      --grad-opacity-mid: 0.75;
      --grad-opacity-end: 0;
      --grad-stop-1: 31%;
      --grad-stop-1a: 44%;
      --grad-opacity-1a: 0.905;
      --grad-stop-2: 57%;
      --grad-stop-2a: 75.5%;
      --grad-opacity-2a: 0.415;
      --grad-stop-3: 94%;
		}
	}
	
	@media (min-width: 2560px) {
		html.dark {
			--grad-direction: 95deg;
      --grad-opacity-start: 1;
      --grad-opacity-mid: 0.74;
      --grad-opacity-end: 0;
      --grad-stop-1: 40%;
      --grad-stop-1a: 54%;
      --grad-opacity-1a: 0.87;
      --grad-stop-2: 60%;
      --grad-stop-2a: 69%;
      --grad-opacity-2a: 0.51;
      --grad-stop-3: 78%;
		}
	}

	/* Full overlay for Section 0 
	   Shape: linear-gradient (change to radial-gradient for circular effect)
	   For radial: replace "var(--full-direction)" with "circle at top left" */
	.overlay-full {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 2;
		pointer-events: none;
		opacity: 1;
		transition: opacity 0.3s ease;
		background: linear-gradient(
			var(--full-direction),
			rgba(var(--overlay-color), var(--full-opacity-start)) var(--full-stop-1),
			rgba(var(--overlay-color), var(--full-opacity-mid)) var(--full-stop-2),
			rgba(var(--overlay-color), var(--full-opacity-end)) var(--full-stop-3)
		);
	}

	/* Gradient overlay for Section 1
	   Shape: linear-gradient (change to radial-gradient for circular effect)
	   For radial: replace "var(--grad-direction)" with "circle at left center" */
	.overlay-gradient {
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		z-index: 2;
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.3s ease;
		/* Uses deeper blue (#a8cce3 = 168, 204, 227) for all stops */
		--overlay-gradient-color: 168, 204, 227;
		background: linear-gradient(
			var(--grad-direction),
			rgba(var(--overlay-gradient-color), var(--grad-opacity-start)) var(--grad-stop-1),
			rgba(var(--overlay-gradient-color), var(--grad-opacity-1a, var(--grad-opacity-start))) var(--grad-stop-1a, var(--grad-stop-1)),
			rgba(var(--overlay-gradient-color), var(--grad-opacity-mid)) var(--grad-stop-2),
			rgba(var(--overlay-gradient-color), var(--grad-opacity-2a, var(--grad-opacity-mid))) var(--grad-stop-2a, var(--grad-stop-2)),
			rgba(var(--overlay-gradient-color), var(--grad-opacity-end)) var(--grad-stop-3)
		);
	}

	html.dark .overlay-gradient {
		--overlay-gradient-color: 7, 13, 23;
	}


	.scroll-panel {
		min-height: 100vh;
		width: 100%;
		display: flex;
		align-items: flex-start;
		justify-content: flex-start;
		position: relative;
		z-index: 10;
	}

	/* Override default section fade for this experience */
	.scroll-panel .section {
		opacity: 1 !important;
		transform: none !important;
	}

	/* ============================================
	   MOBILE CARD STACKING EFFECT (â‰¤1024px)
	   - Sections 0-1 (Hero, About): Original behavior with background image
	   - Section 2+ (Skills onward): Card stacking effect
	   ============================================ */
	@media (max-width: 1024px) {
		#scroll-root {
			height: auto !important;
		}

		.scroll-stage {
			height: auto !important;
			overflow: visible;
			position: relative;
		}

		/* Background layers - FIXED position so they stay visible behind sections 0-1 */
		.base-background {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 0;
		}

		.background-image-layer {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 1;
		}

		.overlay-full {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 2;
		}

		.overlay-gradient {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 3;
		}

		/* Base scroll-panel styles */
		.scroll-panel {
			min-height: 100vh;
			position: relative;
		}

		/* ========== SECTION 0 (Hero) - Original behavior ========== */
		.scroll-panel#home,
		.scroll-panel:nth-child(1) {
			background: transparent;
			position: relative;
			z-index: 10;
		}

		.scroll-panel#home .section,
		.scroll-panel#home .container,
		.scroll-panel#home .hero,
		.scroll-panel:nth-child(1) .section,
		.scroll-panel:nth-child(1) .container {
			background: transparent !important;
		}

		/* ========== SECTION 1 (About) - Sticky behavior with tolerance ========== */
		.scroll-panel#about,
		.scroll-panel:nth-child(2) {
			background: transparent;
			position: sticky;
			top: 0;
			z-index: 11;
			/* Tolerance area - extra height for scrolling before next section covers */
			margin-bottom: 30vh;
		}

		.scroll-panel#about .section,
		.scroll-panel#about .container,
		.scroll-panel:nth-child(2) .section,
		.scroll-panel:nth-child(2) .container {
			background: transparent !important;
		}

		/* ========== SECTION 2+ (Skills onward) - Card stacking ========== */
		.scroll-panel:nth-child(n+3) {
			position: sticky;
			top: 0;
			background: var(--bg-primary);
			/* Shadow for depth effect as cards stack */
			box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.08), 0 -2px 8px rgba(0, 0, 0, 0.04);
			/* Rounded top corners for card effect */
			border-top-left-radius: 20px;
			border-top-right-radius: 20px;
		}

		html.dark .scroll-panel:nth-child(n+3) {
			box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.3), 0 -2px 8px rgba(0, 0, 0, 0.2);
		}

		/* Z-index stacking for card sections (starting from section 2) */
		.scroll-panel:nth-child(3) { z-index: 30; }  /* Skills */
		.scroll-panel:nth-child(4) { z-index: 40; }  /* Projects */
		.scroll-panel:nth-child(5) { z-index: 50; }  /* Timeline */
		.scroll-panel:nth-child(6) { z-index: 60; }  /* Contact */
		.scroll-panel:nth-child(7) { z-index: 70; }
		.scroll-panel:nth-child(8) { z-index: 80; }

		/* Ensure card sections have solid background */
		.scroll-panel:nth-child(n+3) .section,
		.scroll-panel:nth-child(n+3) .container {
			background: var(--bg-primary);
			border-top-left-radius: 20px;
			border-top-right-radius: 20px;
		}

		/* Timeline section */
		#timeline {
			background: var(--bg-primary);
			position: sticky;
			top: 0;
			box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.08);
			border-top-left-radius: 20px;
			border-top-right-radius: 20px;
		}

		html.dark #timeline {
			box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.3);
		}

		/* Ensure proper stacking for content visibility */
		.scroll-panel .section {
			position: relative;
		}
	}

	/* Test animated ball for scroll progress */
	.scroll-progress-ball {
		position: fixed;
		top: 50px;
		left: 0;
		width: 60px;
		height: 60px;
		border-radius: 50%;
		background: var(--accent-primary);
		box-shadow: 0 0 20px rgba(100, 116, 139, 0.3);
		z-index: 9999;
		pointer-events: none;
		transform: translate(0, 0);
		opacity: 0.8;
	}

	html.dark .scroll-progress-ball {
		box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
	}
</style>
